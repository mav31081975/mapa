<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0,
               user-scalable=no, viewport-fit=cover">

<title>Geo-Explorer • JPG + Fronteras (Opción A Estable)</title>

<!-- D3 + TopoJSON SOLO para dibujar fronteras -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>

<style>
:root {
  --accent: #00ffcc;
}

/* ================= BASE ================= */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100dvh;
  overflow: hidden;
  background: #000;
  font-family: monospace;
}

#map-container {
  position: relative;
  width: 100vw;
  height: 100dvh;
  touch-action: none;
  cursor: crosshair;
}

/* ================= MAPA JPG (REFERENCIA REAL) ================= */
#world-map {
  width: 100%;
  height: 100%;
  object-fit: fill;          /* CRÍTICO: equirectangular */
  display: block;
}

/* ================= SVG SUPERPUESTO (VISUAL ONLY) ================= */
#borders-svg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;      /* NO INTERFIERE */
  z-index: 2;
}

/* Fronteras */
.border {
  fill: none;
  stroke: rgba(255, 255, 255, 0.65); /* blanco contrastante */
  stroke-width: 1.2px;
  vector-effect: non-scaling-stroke;
}

/* ================= PANEL ================= */
#info-panel {
  position: absolute;
  width: 320px;
  padding: 16px;
  background: rgba(15,15,15,0.8);
  border: 1px solid rgba(0,255,204,0.4);
  color: #fff;
  z-index: 10;
  transition: transform 0.4s ease;
  text-align: center;        /* CENTRADO DEL PANEL */
}

.label {
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--accent);
}
.value {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
}

.coords {
  display: flex;
  gap: 16px;
  justify-content: center;   /* CENTRADO DE LAS DOS COLUMNAS */
}
.coords > div {
  text-align: center;        /* CENTRADO DE CADA COLUMNA */
}

/* Texto de crédito (debajo del panel) */
.devline {
  margin-top: 10px;
  font-size: 16px;           /* apenas menor que 18px */
  color: rgba(255,255,255,0.75);
  line-height: 1.25;
  overflow-wrap: anywhere;   /* evita que el email “desborde” */
  word-break: break-word;
}

/* Posiciones del panel */
.pos-tl { top: 15px; left: 15px; }
.pos-tr { top: 15px; left: calc(100% - 355px); }
.pos-bl { top: calc(100% - 150px); left: 15px; }
.pos-br { top: calc(100% - 150px); left: calc(100% - 355px); }

/* Mobile */
body.is-mobile #info-panel {
  width: 240px;
}
</style>
</head>

<body>

<div id="map-container">

  <!-- MAPA JPG (BASE) -->
  <img
    id="world-map"
    src="https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg"
    alt="Mapa mundial">

  <!-- SVG DE FRONTERAS (SOLO VISUAL) -->
  <svg id="borders-svg"></svg>

  <!-- PANEL -->
  <div id="info-panel" class="pos-tr">
    <div class="label">UBICACIÓN POLÍTICA</div>
    <div id="country-name" class="value">CARGANDO…</div>

    <div class="coords">
      <div>
        <div class="label">LATITUD</div>
        <div id="lat-val" class="value">0.00°</div>
      </div>
      <div>
        <div class="label">LONGITUD</div>
        <div id="lon-val" class="value">0.00°</div>
      </div>
    </div>

    <!-- Línea de crédito (texto generado desde Base64) -->
    <div id="dev-line" class="devline"></div>
  </div>
</div>

<script>
/* =====================================================
   REFERENCIAS (TU LÓGICA ORIGINAL)
   ===================================================== */
const mapImg = document.getElementById("world-map");
const panel = document.getElementById("info-panel");
const countryText = document.getElementById("country-name");
const latText = document.getElementById("lat-val");
const lonText = document.getElementById("lon-val");

/* Créditos (se muestran en el panel, pero NO están en claro en el HTML) */
const devLine = document.getElementById("dev-line");

const positions = ["pos-tl","pos-tr","pos-br","pos-bl"];
let posIdx = 1;
let jumping = false;
let ticking = false;

/* ================= MOBILE DETECTION ================= */
const isMobile =
  ("ontouchstart" in window) ||
  (navigator.maxTouchPoints > 0);

if (isMobile) document.body.classList.add("is-mobile");

/* =====================================================
   CRÉDITO (BASE64 → TEXTO EN PANTALLA)
   ===================================================== */
const DEV_NAME_B64 = "TWFydGluY2hlbmtv";
const DEV_EMAIL_B64 = "bWFydGluYWxlamFuZHJvdmVyYUBnbWFpbC5jb20=";

devLine.textContent = `Desarrollado por ${atob(DEV_NAME_B64)} — ${atob(DEV_EMAIL_B64)}`;

/* =====================================================
   PANEL MOVE (IGUAL QUE ANTES)
   ===================================================== */
function movePanel() {
  if (jumping) return;
  jumping = true;
  panel.classList.remove(positions[posIdx]);
  posIdx = (posIdx + 1) % positions.length;
  panel.classList.add(positions[posIdx]);
  setTimeout(() => jumping = false, 400);
}

/* =====================================================
   DATA POLÍTICA (para geoContains)
   ===================================================== */
let countriesData = null;

/* =====================================================
   UPDATE UI — REFERENCIA: JPG
   ===================================================== */
function updateUI(clientX, clientY) {
  const rect = mapImg.getBoundingClientRect();
  const x = clientX - rect.left;
  const y = clientY - rect.top;

  if (x < 0 || y < 0 || x > rect.width || y > rect.height) {
    ticking = false;
    return;
  }

  const lon = (x / rect.width) * 360 - 180;
  const lat = 90 - (y / rect.height) * 180;

  latText.textContent = lat.toFixed(4);
  lonText.textContent = lon.toFixed(4);

  if (countriesData) {
    const match = countriesData.features.find(f => d3.geoContains(f, [lon, lat]));
    countryText.textContent = match
      ? String(match.properties && match.properties.name ? match.properties.name : "—").toUpperCase()
      : "OCÉANO";
  }

  ticking = false;
}

/* =====================================================
   EVENTOS (IGUALES A TU BASE)
   ===================================================== */
if (!isMobile) {
  window.addEventListener("pointermove", e => {
    if (!ticking) {
      requestAnimationFrame(() => updateUI(e.clientX, e.clientY));
      ticking = true;
    }
  });
  panel.addEventListener("mouseenter", movePanel);
} else {
  window.addEventListener("touchmove", e => {
    const t = e.touches[0];
    updateUI(t.clientX, t.clientY);

    const r = panel.getBoundingClientRect();
    if (
      t.clientX >= r.left &&
      t.clientX <= r.right &&
      t.clientY >= r.top &&
      t.clientY <= r.bottom
    ) {
      movePanel();
    }
  }, { passive:false });

  panel.addEventListener("touchstart", e => {
    e.preventDefault();
    movePanel();
  }, { passive:false });
}

/* =====================================================
   FRONTERAS VECTORIALES (SOLO DIBUJO) + CARGA DATA
   ===================================================== */
const svg = d3.select("#borders-svg");

function project([lon, lat]) {
  const w = svg.node().clientWidth;
  const h = svg.node().clientHeight;
  return [
    (lon + 180) / 360 * w,
    (90 - lat) / 180 * h
  ];
}

const path = d3.geoPath().projection({
  stream: stream => ({
    point(lon, lat) {
      const [x, y] = project([lon, lat]);
      stream.point(x, y);
    },
    lineStart: () => stream.lineStart(),
    lineEnd: () => stream.lineEnd(),
    polygonStart: () => stream.polygonStart(),
    polygonEnd: () => stream.polygonEnd()
  })
});

d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
  .then(world => {
    countriesData = topojson.feature(world, world.objects.countries);
    countryText.textContent = "LISTO";

    svg
      .attr("width", "100%")
      .attr("height", "100%");

    svg.selectAll("path")
      .data(countriesData.features)
      .enter()
      .append("path")
      .attr("class", "border")
      .attr("d", path);
  })
  .catch(err => {
    console.error(err);
    countryText.textContent = "ERROR DATOS";
  });

window.addEventListener("resize", () => {
  svg.selectAll("path").attr("d", path);
});
</script>

</body>
</html>
